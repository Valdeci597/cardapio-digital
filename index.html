<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio Digital</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #E74C3C;
            --primary-dark: #C0392B;
            --secondary: #2ECC71;
            --dark: #2C3E50;
            --light: #ECF0F1;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #FAFAFA;
            color: var(--dark);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .logo-container {
            max-width: 180px;
            margin: 0 auto 15px;
        }

        .logo-container img {
            width: 100%;
            border-radius: 8px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--dark);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: #1A252F;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--white);
        }

        .menu-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .menu-item {
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .menu-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .menu-item-content {
            padding: 15px;
        }

        .admin-panel {
            display: none;
            background: var(--light);
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .admin-tab {
            padding: 10px 20px;
            background: #ddd;
            border: none;
            cursor: pointer;
        }

        .admin-tab.active {
            background: var(--primary);
            color: white;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }

        @media (max-width: 768px) {
            .menu-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="main-menu">
        <header>
            <div class="logo-container">
                <img id="restaurant-logo" src="https://via.placeholder.com/180x80?text=Logo" alt="Logo">
            </div>
            <h1 id="restaurant-name">Meu Estabelecimento</h1>
            <button class="btn btn-primary" id="admin-toggle">
                <i class="fas fa-cog"></i> Admin
            </button>
        </header>
        
        <div class="menu-container" id="menu-items">
            <!-- Itens do cardápio serão carregados aqui -->
        </div>
    </div>

    <!-- Painel Administrativo -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="config">Configurações</button>
            <button class="admin-tab" data-tab="menu">Cardápio</button>
        </div>
        
        <div class="admin-section active" id="config-tab">
            <h2><i class="fas fa-cog"></i> Configurações</h2>
            <form id="config-form">
                <div class="form-group">
                    <label>Nome do Estabelecimento:</label>
                    <input type="text" class="form-control" id="restaurant-name-input" required>
                </div>
                
                <div class="form-group">
                    <label>Logo:</label>
                    <input type="file" class="form-control" id="logo-upload" accept="image/*">
                    <small>Recomendado: 180x80 pixels</small>
                    <div id="logo-preview" style="margin-top: 10px;"></div>
                </div>
                
                <div class="form-group">
                    <label>WhatsApp para Pedidos:</label>
                    <input type="text" class="form-control" id="whatsapp-number" placeholder="5511999999999" required>
                </div>
                
                <div class="form-group">
                    <label>Categorias (separadas por vírgula):</label>
                    <input type="text" class="form-control" id="categories" placeholder="Ex: Pizzas, Bebidas, Sobremesas" required>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Salvar Configurações
                </button>
            </form>
        </div>
        
        <div class="admin-section" id="menu-tab">
            <h2><i class="fas fa-utensils"></i> Gerenciar Cardápio</h2>
            <button class="btn btn-secondary" id="add-item-btn">
                <i class="fas fa-plus"></i> Adicionar Item
            </button>
            
            <div id="menu-items-list" style="margin-top: 20px;">
                <!-- Itens do cardápio para edição -->
            </div>
        </div>
    </div>

    <!-- Modal de Item -->
    <div class="login-modal" id="item-modal">
        <div class="login-content">
            <h2 id="item-modal-title"><i class="fas fa-utensils"></i> Novo Item</h2>
            <form id="item-form">
                <input type="hidden" id="item-id">
                
                <div class="form-group">
                    <label>Nome do Item:</label>
                    <input type="text" class="form-control" id="item-name" required>
                </div>
                
                <div class="form-group">
                    <label>Descrição:</label>
                    <textarea class="form-control" id="item-description" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Preço:</label>
                    <input type="number" step="0.01" class="form-control" id="item-price" required>
                </div>
                
                <div class="form-group">
                    <label>Categoria:</label>
                    <select class="form-control" id="item-category" required>
                        <option value="">Selecione uma categoria</option>
                        <!-- Categorias serão carregadas dinamicamente -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Imagem:</label>
                    <input type="file" class="form-control" id="item-image-upload" accept="image/*">
                    <div id="item-image-preview" style="margin-top: 10px;"></div>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Salvar Item
                </button>
                <button type="button" class="btn" id="cancel-item" style="margin-left: 10px;">
                    Cancelar
                </button>
            </form>
        </div>
    </div>

    <!-- Modal de Login -->
    <div class="login-modal" id="login-modal">
        <div class="login-content">
            <h2><i class="fas fa-lock"></i> Acesso Administrativo</h2>
            <form id="login-form">
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" class="form-control" id="admin-password" required>
                </div>
                <div class="login-error" id="login-error"></div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <script>
        // Configuração do Firebase - Substitua pelos seus dados!
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            appId: "SEU_APP_ID"
        };

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Variáveis globais
        let menuItems = [];
        let editingItemId = null;
        let restaurantConfig = {
            name: "Meu Estabelecimento",
            logo: "https://via.placeholder.com/180x80?text=Logo",
            whatsapp: "",
            categories: []
        };

        // Elementos do DOM
        const elements = {
            // Cardápio
            menuItemsContainer: document.getElementById('menu-items'),
            
            // Admin
            adminToggle: document.getElementById('admin-toggle'),
            adminPanel: document.getElementById('admin-panel'),
            adminTabs: document.querySelectorAll('.admin-tab'),
            adminSections: document.querySelectorAll('.admin-section'),
            
            // Configurações
            configForm: document.getElementById('config-form'),
            restaurantName: document.getElementById('restaurant-name'),
            restaurantNameInput: document.getElementById('restaurant-name-input'),
            restaurantLogo: document.getElementById('restaurant-logo'),
            logoUpload: document.getElementById('logo-upload'),
            logoPreview: document.getElementById('logo-preview'),
            whatsappNumber: document.getElementById('whatsapp-number'),
            categoriesInput: document.getElementById('categories'),
            
            // Gerenciamento de Itens
            addItemBtn: document.getElementById('add-item-btn'),
            menuItemsList: document.getElementById('menu-items-list'),
            
            // Modais
            loginModal: document.getElementById('login-modal'),
            loginForm: document.getElementById('login-form'),
            passwordInput: document.getElementById('admin-password'),
            loginError: document.getElementById('login-error'),
            
            itemModal: document.getElementById('item-modal'),
            itemForm: document.getElementById('item-form'),
            itemModalTitle: document.getElementById('item-modal-title'),
            itemId: document.getElementById('item-id'),
            itemName: document.getElementById('item-name'),
            itemDescription: document.getElementById('item-description'),
            itemPrice: document.getElementById('item-price'),
            itemCategory: document.getElementById('item-category'),
            itemImageUpload: document.getElementById('item-image-upload'),
            itemImagePreview: document.getElementById('item-image-preview'),
            cancelItemBtn: document.getElementById('cancel-item')
        };

        // Funções Firebase
        async function uploadImage(file, path) {
            try {
                const storageRef = storage.ref(`${path}/${Date.now()}_${file.name}`);
                await storageRef.put(file);
                return await storageRef.getDownloadURL();
            } catch (error) {
                console.error("Erro no upload:", error);
                return null;
            }
        }

        async function loadConfig() {
            try {
                const doc = await db.collection("config").doc("restaurant").get();
                if (doc.exists) {
                    restaurantConfig = doc.data();
                    updateUI();
                }
            } catch (error) {
                console.error("Erro ao carregar configurações:", error);
            }
        }

        async function saveConfig() {
            try {
                await db.collection("config").doc("restaurant").set(restaurantConfig);
                alert("Configurações salvas com sucesso!");
                return true;
            } catch (error) {
                console.error("Erro ao salvar configurações:", error);
                alert("Erro ao salvar configurações!");
                return false;
            }
        }

        async function loadMenuItems() {
            try {
                const snapshot = await db.collection("menuItems").get();
                menuItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderMenuItems();
                renderAdminItems();
            } catch (error) {
                console.error("Erro ao carregar itens:", error);
            }
        }

        async function saveMenuItem(item) {
            try {
                if (editingItemId) {
                    await db.collection("menuItems").doc(editingItemId).update(item);
                } else {
                    await db.collection("menuItems").add(item);
                }
                return true;
            } catch (error) {
                console.error("Erro ao salvar item:", error);
                return false;
            }
        }

        async function deleteMenuItem(itemId) {
            try {
                await db.collection("menuItems").doc(itemId).delete();
                return true;
            } catch (error) {
                console.error("Erro ao excluir item:", error);
                return false;
            }
        }

        // Funções de Renderização
        function updateUI() {
            elements.restaurantName.textContent = restaurantConfig.name;
            elements.restaurantLogo.src = restaurantConfig.logo;
            elements.restaurantNameInput.value = restaurantConfig.name;
            elements.whatsappNumber.value = restaurantConfig.whatsapp;
            elements.categoriesInput.value = restaurantConfig.categories.join(', ');
            
            // Atualiza categorias no modal de itens
            updateCategorySelect();
        }

        function updateCategorySelect() {
            const categorySelect = elements.itemCategory;
            categorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            if (restaurantConfig.categories && restaurantConfig.categories.length > 0) {
                restaurantConfig.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = "Outros";
                option.textContent = "Outros";
                categorySelect.appendChild(option);
            }
        }

        function renderMenuItems() {
            elements.menuItemsContainer.innerHTML = '';
            
            if (menuItems.length === 0) {
                elements.menuItemsContainer.innerHTML = `
                    <div style="grid-column:1/-1; text-align:center; padding:40px;">
                        <i class="fas fa-utensils" style="font-size:3rem; color:#ddd;"></i>
                        <p style="color:#666;">Nenhum item disponível no cardápio</p>
                    </div>
                `;
                return;
            }
            
            // Agrupa por categoria
            const categories = [...new Set(menuItems.map(item => item.category || 'Outros'))];
            
            categories.forEach(category => {
                // Cabeçalho da categoria
                const categoryHeader = document.createElement('h2');
                categoryHeader.textContent = category;
                categoryHeader.style.gridColumn = '1/-1';
                categoryHeader.style.marginTop = '20px';
                elements.menuItemsContainer.appendChild(categoryHeader);
                
                // Itens da categoria
                menuItems
                    .filter(item => (item.category || 'Outros') === category)
                    .forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'menu-item';
                        itemElement.innerHTML = `
                            <img src="${item.image || 'https://via.placeholder.com/300x200?text=Sem+Imagem'}" alt="${item.name}">
                            <div class="menu-item-content">
                                <h3>${item.name}</h3>
                                <p>${item.description}</p>
                                <p style="font-weight:bold; color:var(--primary); margin-top:10px;">
                                    R$ ${item.price.toFixed(2)}
                                </p>
                            </div>
                        `;
                        elements.menuItemsContainer.appendChild(itemElement);
                    });
            });
        }

        function renderAdminItems() {
            elements.menuItemsList.innerHTML = '';
            
            menuItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'menu-item';
                itemElement.style.marginBottom = '15px';
                itemElement.style.padding = '15px';
                itemElement.style.background = 'white';
                itemElement.style.borderRadius = '5px';
                itemElement.innerHTML = `
                    <div style="display:flex; gap:15px; align-items:center;">
                        <img src="${item.image || 'https://via.placeholder.com/100x100?text=Sem+Imagem'}" 
                             style="width:80px; height:80px; object-fit:cover; border-radius:5px;">
                        <div style="flex:1;">
                            <h3 style="margin-bottom:5px;">${item.name}</h3>
                            <p style="margin-bottom:5px; color:#666;">${item.description}</p>
                            <p style="font-weight:bold;">R$ ${item.price.toFixed(2)} | ${item.category || 'Outros'}</p>
                        </div>
                        <button class="btn btn-primary edit-item" data-id="${item.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-secondary delete-item" data-id="${item.id}" style="background:var(--primary);">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                elements.menuItemsList.appendChild(itemElement);
            });
            
            // Adiciona eventos aos botões
            document.querySelectorAll('.edit-item').forEach(btn => {
                btn.addEventListener('click', () => editItem(btn.getAttribute('data-id')));
            });
            
            document.querySelectorAll('.delete-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja excluir este item?')) {
                        deleteItem(btn.getAttribute('data-id'));
                    }
                });
            });
        }

        // Funções de Gestão de Itens
        function openItemModal() {
            elements.itemModal.style.display = 'flex';
        }

        function closeItemModal() {
            elements.itemModal.style.display = 'none';
            elements.itemForm.reset();
            elements.itemImagePreview.innerHTML = '';
            editingItemId = null;
        }

        function editItem(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (item) {
                editingItemId = itemId;
                elements.itemModalTitle.innerHTML = `<i class="fas fa-edit"></i> Editar Item`;
                elements.itemId.value = item.id;
                elements.itemName.value = item.name;
                elements.itemDescription.value = item.description;
                elements.itemPrice.value = item.price;
                
                // Atualiza as categorias antes de definir o valor
                updateCategorySelect();
                elements.itemCategory.value = item.category || '';
                
                if (item.image) {
                    elements.itemImagePreview.innerHTML = `
                        <img src="${item.image}" style="max-width:100px; border-radius:5px;">
                        <p>Imagem atual</p>
                    `;
                }
                
                openItemModal();
            }
        }

        async function deleteItem(itemId) {
            if (await deleteMenuItem(itemId)) {
                menuItems = menuItems.filter(item => item.id !== itemId);
                renderMenuItems();
                renderAdminItems();
            }
        }

        // Event Listeners
        elements.adminToggle.addEventListener('click', () => {
            elements.loginModal.style.display = 'flex';
        });

        elements.loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (elements.passwordInput.value === "admin123") {
                elements.loginModal.style.display = 'none';
                elements.adminPanel.style.display = 'block';
                loadConfig();
                loadMenuItems();
            } else {
                elements.loginError.textContent = "Senha incorreta!";
            }
        });

        elements.configForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Atualiza logo se foi enviada uma nova
            if (elements.logoUpload.files[0]) {
                const logoUrl = await uploadImage(elements.logoUpload.files[0], 'logos');
                if (logoUrl) {
                    restaurantConfig.logo = logoUrl;
                    elements.restaurantLogo.src = logoUrl;
                    elements.logoPreview.innerHTML = `
                        <img src="${logoUrl}" style="max-width:100px; border-radius:5px;">
                        <p>Nova logo</p>
                    `;
                }
            }
            
            restaurantConfig = {
                ...restaurantConfig,
                name: elements.restaurantNameInput.value,
                whatsapp: elements.whatsappNumber.value,
                categories: elements.categoriesInput.value.split(',').map(cat => cat.trim()).filter(cat => cat)
            };
            
            if (await saveConfig()) {
                updateUI();
            }
        });

        elements.addItemBtn.addEventListener('click', () => {
            editingItemId = null;
            elements.itemModalTitle.innerHTML = `<i class="fas fa-plus"></i> Novo Item`;
            elements.itemForm.reset();
            elements.itemImagePreview.innerHTML = '';
            updateCategorySelect(); // Atualiza as categorias
            openItemModal();
        });

        elements.itemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const itemData = {
                name: elements.itemName.value,
                description: elements.itemDescription.value,
                price: parseFloat(elements.itemPrice.value),
                category: elements.itemCategory.value
            };
            
            // Upload da imagem se foi enviada
            if (elements.itemImageUpload.files[0]) {
                const imageUrl = await uploadImage(elements.itemImageUpload.files[0], 'menu-items');
                if (imageUrl) {
                    itemData.image = imageUrl;
                }
            }
            
            if (await saveMenuItem(itemData)) {
                closeItemModal();
                loadMenuItems(); // Recarrega os itens
            }
        });

        elements.cancelItemBtn.addEventListener('click', closeItemModal);

        elements.adminTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Remove active de todas as tabs e sections
                elements.adminTabs.forEach(t => t.classList.remove('active'));
                elements.adminSections.forEach(s => s.classList.remove('active'));
                
                // Adiciona active ao selecionado
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        elements.itemImageUpload.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    elements.itemImagePreview.innerHTML = `
                        <img src="${event.target.result}" style="max-width:100px; border-radius:5px;">
                        <p>Pré-visualização</p>
                    `;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        elements.logoUpload.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    elements.logoPreview.innerHTML = `
                        <img src="${event.target.result}" style="max-width:100px; border-radius:5px;">
                        <p>Pré-visualização</p>
                    `;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
            loadMenuItems();
        });
    </script>
</body>
</html>